<!DOCTYPE html>

<html lang="en">

        <head>
                <!-- Page information -->
                <meta charset="UTF-8" />
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <link rel="shortcut icon" href="/favicon.ico" />

                <!-- Set title -->
                <title>Dragon Hearts</title>

                <!-- Includes -->
                <link rel="stylesheet" href="/DragonHearts/output/html/98682199-5ac9-448c-afc8-23ab7359a91b-static/mermaid.css" />
                <link rel="stylesheet" href="/DragonHearts/output/html/98682199-5ac9-448c-afc8-23ab7359a91b-static/main.css" />
                <script src="/DragonHearts/output/html/98682199-5ac9-448c-afc8-23ab7359a91b-static/mermaid.min.js"></script> 
                <link rel="stylesheet" href="/DragonHearts/output/html/98682199-5ac9-448c-afc8-23ab7359a91b-static/graph.css" />
<script src="https://d3js.org/d3.v4.min.js"></script>


                <!-- Onload tweaks -->
                <script>
                        // add prefix to hash to avoid scrolling
                        if (window.location.hash != '' && window.location.hash.substr(1)[0] != '!'){
                                window.location.hash = '!' + window.location.hash.substr(1);
                        }
                </script>
        </head>

<body onload="LoadPage();">
<div id="header" class="header">
        <a href="/DragonHearts/output/html/" id="homelink" title="Clear screen and go to homepage">Dragon Hearts</a>

        <div style="width:1.6rem; height:1.6rem; position:fixed; left:calc(100vw - 2rem);top: 0.9rem;">
                <a href="/DragonHearts/output/html/tags" title="Open tag view">
                        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                                <path d="M0,0v512h512V0H0z M462.452,462.452H49.548V49.548h412.903V462.452z" fill="#f0f0f0"></path>
                                <path d="M371.613,231.226v-49.548h-41.29v-41.29h-49.548v41.29h-49.548v-41.29h-49.548v41.29h-41.29v49.548h41.29v49.548h-41.29
                                        v49.548h41.29v41.29h49.548v-41.29h49.548v41.29h49.548v-41.29h41.29v-49.548h-41.29v-49.548H371.613z M280.774,280.774h-49.548
                                        v-49.548h49.548V280.774z" fill="#c2c9ce"></path>
                        </svg>
                </a>
        </div>
</div>
<div class="container-wrapper">
        <div class="container">
        <h1 id="jan-12-2022-session-1">Jan 12, 2022 Session 1</h1>
<p>Town is <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Hannat.html">Hannat</a> where we are at - first establishment in mountains <br />
east of the swamp   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Crying Pony.html">The Crying Pony</a> -- inn   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Sedwig.html">Sedwig</a> - barman - human - chubby - really happy to give legal and questionable services - well known as a fence <br />
already preparing drinks for us <br />
pased me a parchment   </p>
<p>adventuring board in taverns - w have used for previous levels   </p>
<p>written in common - 8 year old simply worded <br />
not <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Sedwig.html">Sedwig</a>'s writing <br />
I recognize the handwriting - it's far from a child <br />
"certain followers of evil that are fighting close by get loot get paid" <br />
bear logo in corner - message has been sent by my contact <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Iron the Bonker.html">Iron the Bonker</a>   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Bloodbear Clan.html">Bloodbear Clan</a> member - one more word - after investigations, meet at the <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Valley Fighting Pit.html">Valley Fighting Pit</a> very close by - very favored by the bears - disputes are settled there - 30 minutes walk to the west   </p>
<hr />
<p>golden eyes - Tiefling - <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> recognizes - so does <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> <br />
her name is <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Rothorn.html">Rothorn</a>   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Circle.html">The Circle</a> has informed her of a battle - certain followers and dragons that interacted with each other - highly recommend going in this area.  <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Circle.html">The Circle</a> trying to regain control of certain territories that dragon's occupied   </p>
<p>gives Duff of Smoke bottle to <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a>.  Language Potion to <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a>   </p>
<p>she's a student of divination <br />
uncover strange artifacts/etc - will be compensated by <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Rothorn.html">Rothorn</a>   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> says he's here for investigation, not to do the <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Circle.html">The Circle</a>'s bidding - dead valley.   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Vormorn.html">Vormorn</a> hears about battlefield - can take anyone with them   </p>
<p>it's 8am   </p>
<hr />
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> leads us to desolated area - some parts are churned some are foggy with green merk <br />
hundreds of corpses - recent battle <br />
carrion birds swarming around - death/blood/shit smell <br />
very very sour in air - poisonous in the air that has been used for attack   </p>
<p>this came from a humanoid level - most likely not dragon   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> looks panicked by all the death - looking at fog, "just like back home" -- nature check - 6+5=11 <br />
recognize two specific symbols -  <br />
one golden stitched sun symbol - on shoulder, some burnt into neck <br />
very strange monstrosities that ooze poison from their fangs, might be able to ride them   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> roll to search for survivors <br />
may have been here for a while, but smells are very fresh   </p>
<p>3 hills - in between there is slight curve - where most clashes happened   </p>
<p>investigate the dead: <br />
find strange individual - big red robe - reinforced shoulder pads and hat - pulled down to eyes - also ending in pointing shape on top <br />
seems diff sun symbols burned into neck <br />
they seem to have a tome of some sort attached to body with chain   </p>
<p>the wind shifts - and fresh air hits us   </p>
<p>in back, huge black spear - chain all over them   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> gets book - it's in draconic - <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> reads it <br />
there is a strange time calc - 72nd year of <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The New Dawn.html">The New Dawn</a>   </p>
<p>mentions: <br />
<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Kraz Lagan the Menacing.html">Kraz Lagan the Menacing</a>  fanatic ramblings and weird achievements -  <br />
mentioned "<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Crimson Dawn.html">Crimson Dawn</a> may never seize" - maybe the name of the Sun symbols group of dead. <br />
<a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Biled.html">The Biled</a> - is the other group   </p>
<p>something catches <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> ear - something skittering to the north - there are a couple of people moving through the corpses   </p>
<p>on furthest hill - some with similar red robes and yellow endings and some with rag-tagged - they are scavenging - there are five of them.   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> sneaks through bodies and sees --&gt; figure has four chains that are attached to beasts that are hunched over that are harvesting body parts (ears/odd equipment)  <br />
some have three clawed endings   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/DH DM.html">DH DM</a> rolled d8 got 8 inspiration points each   </p>
<p>2 come before - <br />
<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> and <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Vormorn.html">Vormorn</a>   </p>
<p>we destroy the holder ... and one of the beasts, and the rest of the beasts run off.  they look to be made up of different humanoids.  find 3 gold pieces, minor healing potion and a scroll that mentions the ruin at <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Old Scar.html">The Old Scar</a>   </p>
<p>Investigate the woods where the Dark Dwarf summoned <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Vormorn.html">Vormorn</a> ... find half a corpse. <br />
<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Blackened liquid glassy metallic blade.html">Blackened liquid glassy metallic blade</a> - pierced through it all the way into the tree. <br />
<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> tries to take the blade, and it cuts his hands. <br />
<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Vormorn.html">Vormorn</a> uses some forging equipment tongs to grip the very sharp blade, and pulls it out of the tree.  He places it in his backpack.   </p>
<p>The Deadly Black - alcove - found book - mentions <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Kraz Lagan the Menacing.html">Kraz Lagan the Menacing</a>   </p>
<p>We find a statue missing one hand (on purpose) (inscription "protector of the innocent") and an alter.  find inscription that states to "close eyes and look into shadows".   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> approaches the one corner that is darkened and the alter moves aside, exposing an entrance to a chamber.   </p>
<p>It ends up being a laboratory.  6 tubes, one green, the rest red.  body in the green tube, looks to be creating the beasts.   </p>
<p>investigated a cell, found a dragon headed woman.  says <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Crimson Dawn.html">Crimson Dawn</a> must pay.  will give us a favor if we free her.  She built this place. She says to show <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Barnabus The Churned.html">Barnabus The Churned</a> a good time by using his own staff on himself.   </p>
<p>She leaves when we enter room with a bony figure. - We forgot to get her name.   </p>
<p>Room has a fresco painting on ceiling, 3 pegasus.   </p>
<p>Bony figure is most likely <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Barnabus The Churned.html">Barnabus The Churned</a> - he has ears pinned to the wall.   </p>
<p>Battle begins - he says <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Azutrix.html">Azutrix</a>'s power shall punish you. <br />
He's bloodied.   </p>
<p>Dragon snake turns magically blue. <br />
The staff was blue, turns a natural green now.   </p>
<p><a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> takes <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Green Staff.html">Green Staff</a>.     </p>
<p>we run out of crumbling lab, it collapses behind us and is completely destroyed.   </p>
<p>Staff seems to say "Nature is on your side".  <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Jolo Brekk.html">Jolo Brekk</a> recognizes the staff and <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Quinn.html">Quinn</a> gives it to him.   </p>
<hr />
<p>We return to the <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Crying Pony.html">The Crying Pony</a>. <br />
Minting of dragon beads take human blood. <br />
Book was written by <a href="/DragonHearts/output/html/TTRPG/IcewindDale/Duergar.html">Duergar</a> - <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Rothorn.html">Rothorn</a> gives 200g for it.   </p>
<p>we get positive influence with <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Circle.html">The Circle</a> and <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Gatekeepers.html">Gatekeepers</a>   </p>
<p>Dark dwarf (<a href="/DragonHearts/output/html/TTRPG/DragonHeart/Iron the Bonker.html">Iron the Bonker</a>) comes barging into <a href="/DragonHearts/output/html/TTRPG/DragonHeart/The Crying Pony.html">The Crying Pony</a> and puts his head in <a href="/DragonHearts/output/html/TTRPG/DragonHeart/Vormorn.html">Vormorn</a>'s gut.  "Where's my stuff??"</p>
<svg class="graph_svg" id="A65f55dcc4094472399e571737b1fabe8{level}" width="680" height="400"></svg>
<button class="graph_button" id="B65f55dcc4094472399e571737b1fabe8{level}" level="{level}" onclick="run('65f55dcc4094472399e571737b1fabe8'+this.level, 'Jan 12, 2022 Session 1');">Show Graph</button>
<script>
function run(uid, pinnedNode){
    // Get elements
    var _button = document.getElementById('B' + uid);
    var _svg = document.getElementById('A' + uid);
    
    // toggle graph on or off
    var turn_on = true;
    if (_button.innerHTML == 'Hide Graph'){
        _button.innerHTML = 'Show Graph';
        turn_on = false;
        _svg.style.display = "None";
        d3.selectAll("#A" + uid + " > *").remove();
    }
    else {
        _button.innerHTML = "Hide Graph";
        _svg.style.display = "block";

        cont = _svg.parentElement;
        
        if (cont.getBoundingClientRect().right > window.visualViewport.width){
                window.scrollBy(cont.getBoundingClientRect().right - window.visualViewport.width,0)
        }
        
    }

    // run d3 graph

    if (turn_on){
        var svg = d3.select("#A" + uid),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        var color = d3.scaleOrdinal(d3.schemeCategory20);

        var simulation = d3.forceSimulation()
            .force("link", d3.forceLink().id(function(d) { return d.id; }))
            .force("charge", d3.forceManyBody().strength(-100))
            .force("center", d3.forceCenter(width / 2, height / 2))

        d3.json("98682199-5ac9-448c-afc8-23ab7359a91b-static/graph.json", function(error, graph) {
                if (error) throw error;

                var link = svg.append("g")
                .attr("class", "links")
                .selectAll("line")
                .data(graph.links)
                .enter().append("line")
                .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

                var node = svg.append("g")
                .attr("class", "nodes")
                .selectAll("g")
                .data(graph.nodes)
                .enter().append("g")            

                var circles = node.append("circle")
                .attr("r", 5)
                .attr("fill", function(d) { 
                        if (d.id == pinnedNode){
                                return 'red'
                        }
                        return color(d.group); 
                });

                // Create a drag handler and append it to the node object instead
                var drag_handler = d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);

                drag_handler(node);
                
                var lables = node.append("text")
                .text(function(d) {
                        return d.id;
                })
                .attr('x', 6)
                .attr('y', 3)
                .on("click", function(d) {
                    let svg_el = document.getElementById('A' + uid);
                    console.log('A' + uid)
                    let level = parseInt(svg_el.parentElement.id.split('-')[1]);
                    console.log(svg_el.parentElement);
                    console.log(level, level+1);
                    httpGetAsync(encodeURI(d.url), ReceiveCall, level+1, false); 
                    return false; 
                        //window.open(d.url);
                });

                node.append("title")
                .text(function(d) { return d.id; });

                simulation
                .nodes(graph.nodes)
                .on("tick", ticked);

                simulation.force("link")
                .links(graph.links);

                function ticked() {
                        node
                                .attr("transform", function(d) { 
                                        if (d.id == pinnedNode){  
                                                d.fx = (width / 2)
                                                d.fy = (height / 2)  
                                        }                          
                                        return "translate(" + bindx(d.x) + "," + bindy(d.y) + ")";
                                })

                        // //constrains the nodes to be within a box
                        // node
                        //         .attr("cx", function(d) { return let dx = Math.max(d.radius, Math.min(width - d.radius, d.x)); })
                        //         .attr("cy", function(d) { return d.y = Math.max(d.radius, Math.min(height - d.radius, d.y)); }); 
                        link
                                .attr("x1", function(d) { return bindx(d.source.x); })
                                .attr("y1", function(d) { return bindy(d.source.y); })
                                .attr("x2", function(d) { return bindx(d.target.x); })
                                .attr("y2", function(d) { return bindy(d.target.y); });
                }
        });

        function bindx(x){
                if (x > width){
                        return (width - 10);
                } 
                if (x < 0) {
                        return (10);
                }     
                return (x);           
        }
        function bindy(y){
                if (y > height){
                        return (height - 10);
                } 
                if (y < 0) {
                        return (10);
                }     
                return (y);           
        }        

        function dragstarted(d) {
                if (d.id == pinnedNode){
                        return
                }
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();         
        d.fx = d.x;
        d.fy = d.y;
        }

        function dragged(d) {
                if (d.id == pinnedNode){
                        return
                }                
        d.fx = bindx(d3.event.x);
        d.fy = bindy(d3.event.y);
        }

        function dragended(d) {
                if (d.id == pinnedNode){
                        return
                }
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
        }
    }
}
</script>

        <!-- end content -->
        </div>
</div>


<script>
        // Init
        // ----------------------------------------------------------------------------
        function LoadPage(){
                console.log('threshold', (1.2 * 40 * getComputedStyle(document.documentElement).fontSize.split("px")[0]));
                SetLinks(0);
        
                // Scroll container to #header link
                if (window.location.hash != ''){
                        let el = document.getElementById(window.location.hash.substr(2));
                        if (el){
                                el.parentElement.scrollTop = el.offsetTop - 20;
                        }
                }
        }
        
        // Init starting container
        FirstContainer = document.getElementsByClassName('container')[0];
        FirstContainer.id = 'level-0';
        FirstContainer.level = '0';
        SetContainer(FirstContainer);    
        
        // Open the path on loading the page
        // This is everything after ?path=
        var href = window.location.href;
        var path_to_open = [];
        if (href.includes('?path=')){
                path_to_open = href.split('?path=')[1].split('/');
                for (let i = 0; i < path_to_open.length; i++){
                        path_to_open[i] = decodeURIComponent(path_to_open[i]);
                }
        }        
        OpenPath(1);


        // FUNCTIONS 
        // ----------------------------------------------------------------------------

        function OpenPath(level){
                if (path_to_open.length > 0){
                        let path = path_to_open.shift();
                        if (path != ''){
                                httpGetAsync(path, ReceiveCall, level, true);
                        }
                        
                }       
        }
        
        // Change link operation
        function SetLinks(level){
                size_of_rem = getComputedStyle(document.documentElement).fontSize.split("px")[0];
                if (window.visualViewport.width > (1.2 * 40 * size_of_rem))
                {
                        var links = document.getElementsByTagName('a');
                        for (let i=0; i < links.length; i++){
                                let l = links[i];
                                if (l.className == 'anchor'){
                                        continue;
                                }
                                if (l.id == 'homelink'){
                                        continue;
                                }
                                if (l.classList.contains('external-link')){
                                        continue;
                                }
                                if (l.onclick != null){
                                        continue;
                                }
                                l.onclick = function () { 
                                        httpGetAsync(encodeURI(this.attributes.href.nodeValue), ReceiveCall, level+1, false); 
                                        return false; 
                                };
                        }
                }
        }  
        
        function SetContainer(container)
        {
                // This function is called on every (newly created) container. 
                // One container holds one tab

                // Create clickback element
                cb = document.createElement('div');
                cb.className = 'container-clickback';
                cb.id = 'cb' + container.id;
                container.parentElement.appendChild(cb);
                
                cb.onclick = function () { 
                        cont = document.getElementById(this.id.slice(2))
                        window.scrollTo(Math.max(window.visualViewport.pageLeft - (70 - cont.getBoundingClientRect().left), 0), 0)
                };

                // Set url
                // This will be set already if this is not the first tab
                if (typeof container.url === 'undefined'){
                        container.url = window.location.pathname;
                }

                // Set click to get header link
                SetHeaders(container);

                // Load mermaid code
                mermaid.init()

                // set graph svg and button to have unique id across tabs
                svgs = container.querySelectorAll(".graph_svg");
                if (svgs.length == 1){
                        svgs[0].id = svgs[0].id.replace('{level}', container.level)
                }
                
                let buttons = container.querySelectorAll(".graph_button");
                if (buttons.length == 1){
                        buttons[0].level = container.level;
                        buttons[0].id = buttons[0].id.replace('{level}', container.level)
                }
        }

        function SetHeaders(container){
                let els = container.childNodes;
                for (let i  = 0; i < els.length; i++){
                        if (typeof els[i].tagName === 'undefined' || els[i].tagName[0] != 'H'){
                                continue;
                        }

                        // iterate
                        let n = 1;

                        // Test if page is open already in another tab
                        anchor_id = els[i].id + '-anchor';
                        if (document.getElementById(anchor_id)){
                                let loop = true;
                                while (loop){
                                        if (document.getElementById(anchor_id + '_' + n)){
                                                n++;
                                        }
                                        else {
                                                break;
                                        }
                                }
                                anchor_id += '_' + n;
                        }

                        els[i].anchor_id = anchor_id;
                        
                        // Add link icon + a href to the header
                        let href = window.location.origin + container.url + '#!' + els[i].id;
                        els[i].innerHTML = '<a id="' + anchor_id + '" class="anchor" href="'+href+'"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>\n' + els[i].innerHTML
                        
                        // body onload is not called when staying within the page
                        // we need to call the LoadPage() function manually
                        let href_el = document.getElementById(anchor_id);
                        href_el.onclick = function(){
                                window.location.replace(this.href);
                                LoadPage(0);
                        }

                        // Show/hide link icon
                        els[i].onmouseover = function(){
                                document.getElementById(this.anchor_id).style.visibility = 'visible';
                        };
                        els[i].onmouseleave = function(){
                                document.getElementById(this.anchor_id).style.visibility = 'hidden';
                        };     
                }
        }                   

           
        
        function httpGetAsync(theUrl, callback, level, callbackpath)
        {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() { 
                        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                        callback(xmlHttp, level, theUrl, callbackpath);
                }
                xmlHttp.open("GET", theUrl, true); // true for asynchronous 
                xmlHttp.send(null);
        }

        function ReceiveCall(xmlHttp, level, theUrl, callbackpath){
                respUrl = xmlHttp.responseURL;
                responseText = xmlHttp.responseText;

                // Restore header if it has been hidden because of an anchor link
                document.getElementById('header').style.display = 'block';

                // Set body width to level * 40 rem
                document.body.style.width = (level * 40 + 200) + 'rem';  

                // Get html
                let text = responseText.split('<div class="container">')[1];
                text =  text.split('<!-- end content -->')[0];

                // Close all containers with level below given
                CloseUpperContainers(level);

                // Test if container for this level already exists
                // otherwise create
                let levelcont = document.getElementById('level-'+level);
                let isNew = false
                if (levelcont == null) {
                        isNew = true;
                        wrappercont = document.createElement('div');
                        wrappercont.className = 'container-wrapper';
                        wrappercont.id = 'wrapperlevel-'+level;
                        document.body.appendChild(wrappercont);

                        levelcont = document.createElement('div');
                        levelcont.className = 'container';
                        levelcont.id = 'level-'+level;
                        levelcont.level = level;
                }

                // Update content of div
                levelcont.innerHTML = text;

                if (isNew){
                        document.getElementById('wrapperlevel-'+level).appendChild(levelcont);
                }

                // Get the leventcont again from the DOM
                levelcont = document.getElementById('level-'+level);

                // Scroll into view
                levelcont = document.getElementById('level-'+level);
                levelcont.scrollIntoView(true);
                window.scrollTo(window.visualViewport.pageLeft, 0);

                // Scroll container to #header link
                theUrl = decodeURI(theUrl);
                if (theUrl.split('#').length > 1){
                        var el = document.getElementById(theUrl.split('#')[1]);
                        if (el){
                                el.parentElement.scrollTop = el.offsetTop - 20;
                        }
                }

                // Set url property
                levelcont.url = theUrl.split('#')[0];
                
                // Arm new links
                SetLinks(level);
                SetContainer(levelcont);

                // Continue path opening (if started with path opening)
                if (callbackpath){
                        OpenPath(level + 1);
                }
                else {
                        // Start to build new href like https://localhost:8000/?path=
                        let new_href = window.location.pathname + '?path=';

                        // Remove https://localhost:8000/ from link name
                        let new_tab = theUrl.replace(window.location.origin+'/', '');

                        // Add in existing path until the tab where was clicked
                        let tab_links = window.location.href.split('?path=');
                        if (tab_links.length > 1){
                                path_to_open = tab_links[1].split('/');
                                for (let i = 0; i < (level - 1); i++){
                                        new_href += path_to_open[i] + '/'
                                }
                        }
                        
                        // Add in new tab
                        new_href += encodeURIComponent(encodeURI(new_tab)) + '/';

                        // Set
                        window.history.replaceState({}, "", new_href);
                }
        }

        function CloseUpperContainers(level){
                // Close all containers that are higher in level than the level
                // of the container in which a link was clicked
                let cns = document.getElementsByClassName("container-wrapper");
                for (let i=0; i<cns.length; i++){
                        if (cns[i].id){
                                if (cns[i].id.split('-')[1] > level){
                                        cns[i].remove();
                                        CloseUpperContainers(level);
                                        return;
                                }
                        }
                }
        }
</script>           
</body>
</html>
